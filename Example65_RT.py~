#======================================================================
# EXAMPLE 65 - WRAP IN PYTHON
#======================================================================
# Add path
import sys
sys.path.append("/cs/research/medim/projects2/projects/frullan/Documents/HighFreqCode/HighFreq_3DRT/Build/bin")
# Import libraries
import numpy as np
import pyrtgrid as rt
from datetime import datetime
# Folder
folder = "/cs/research/medim/projects2/projects/frullan/Documents/HighFreqCode/Examples/Ex65_python/"
input_folder = folder + "input_data/"
output_folder = folder + "output_data/"

#==============================
# Load data
#==============================
# Dimensions
file_dimensions = input_folder + "dimensions.dat"
dim = np.loadtxt(file_dimensions)
# Sound speed
file_sound_speed = input_folder + "sound_speed.dat"
sound_speed = np.loadtxt(file_sound_speed)
sound_speed = np.reshape(sound_speed, (int(dim[0, 1]), int(dim[0, 0]), int(dim[0, 2])))
sound_speed = np.transpose(sound_speed, (1, 2, 0))
# Initial pressure
file_initial_pressure = input_folder + "initial_pressure_veins.dat"
initial_pressure = np.loadtxt(file_initial_pressure)
initial_pressure = np.reshape(initial_pressure, (int(dim[0, 1]), int(dim[0, 0]), int(dim[0, 2])))
initial_pressure = np.transpose(initial_pressure, (1, 2, 0))
# Sensors
file_sensors = input_folder + "sensors.dat"
sensors = np.loadtxt(file_sensors)
# Create object
rtobj = rt.rtgrid(dim)
# Load sound speed
rtobj.load_c(sound_speed)
# Load initial pressure
rtobj.load_u(initial_pressure)
# Load sensors
rtobj.load_sensors(sensors)

#==============================
# Forward problem
#==============================
sensor_array = np.array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11])
startTime = datetime.now() # time
rtobj.forward_operator(sensor_array)
endTime = datetime.now()
print(endTime - startTime)

input()
